(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,57951,e=>{"use strict";e.s(["AuthProvider",()=>c,"useAuth",()=>i],57951);var t=e.i(43476),r=e.i(71645);function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}let o=e.i(47167).default.env.NEXT_PUBLIC_API_URL||"http://localhost:8080/api",a=new class{async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r="".concat(this.baseURL).concat(e),s={headers:{"Content-Type":"application/json",...t.headers},...t};this.accessToken&&!e.includes("/auth/")&&(s.headers={...s.headers,Authorization:"Bearer ".concat(this.accessToken)});try{let t=await fetch(r,s);if(401===t.status&&this.refreshTokenValue&&!e.includes("/auth/refresh")){if(await this.refreshAccessToken()){s.headers={...s.headers,Authorization:"Bearer ".concat(this.accessToken)};let e=await fetch(r,s);if(!e.ok)throw await this.handleError(e);return e.json()}throw this.clearTokens(),window.location.href="/login",Error("Session expired")}if(!t.ok)throw await this.handleError(t);return t.json()}catch(e){throw console.error("API Error:",e),e}}async handleError(e){try{return await e.json()}catch(t){return{error:"HTTP ".concat(e.status,": ").concat(e.statusText)}}}async refreshAccessToken(){if(!this.refreshTokenValue)return!1;try{let e=await fetch("".concat(this.baseURL,"/auth/refresh"),{method:"POST",headers:{Authorization:"Bearer ".concat(this.refreshTokenValue)}});if(e.ok){let t=await e.json();return this.setTokens(t.accessToken,t.refreshToken),!0}}catch(e){console.error("Token refresh failed:",e)}return!1}setTokens(e,t){this.accessToken=e,this.refreshTokenValue=t,localStorage.setItem("accessToken",e),localStorage.setItem("refreshToken",t)}clearTokens(){this.accessToken=null,this.refreshTokenValue=null,localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")}async register(e){let t=await this.request("/auth/register",{method:"POST",body:JSON.stringify(e)});return t.accessToken&&this.setTokens(t.accessToken,t.refreshToken),t}async login(e){let t=await this.request("/auth/login",{method:"POST",body:JSON.stringify(e)});return t.accessToken&&this.setTokens(t.accessToken,t.refreshToken),t}async refreshToken(){let e=await this.request("/auth/refresh",{method:"POST",headers:{Authorization:"Bearer ".concat(this.refreshTokenValue)}});return e.accessToken&&this.setTokens(e.accessToken,e.refreshToken),e}logout(){this.clearTokens()}isAuthenticated(){return!!this.accessToken}getAccessToken(){return this.accessToken}constructor(e){s(this,"baseURL",void 0),s(this,"accessToken",null),s(this,"refreshTokenValue",null),this.baseURL=e,this.accessToken=localStorage.getItem("accessToken"),this.refreshTokenValue=localStorage.getItem("refreshToken")}}(o),n=(0,r.createContext)(void 0);function c(e){let{children:s}=e,[o,c]=(0,r.useState)(null),[i,h]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{try{var e;if(null==a||null==(e=a.isAuthenticated)?void 0:e.call(a))try{let e=await a.refreshToken();(null==e?void 0:e.user)&&c(e.user)}catch(e){console.error("Token refresh failed:",e),a.clearTokens()}}catch(e){console.error("Auth initialization failed:",e)}finally{h(!1)}})()},[]);let l=async e=>{try{h(!0);let t=await a.login(e);c(t.user)}catch(e){throw e}finally{h(!1)}},u=async e=>{try{h(!0);let t=await a.register(e);c(t.user)}catch(e){throw e}finally{h(!1)}},T=!!o&&a.isAuthenticated();return(0,t.jsx)(n.Provider,{value:{user:o,loading:i,login:l,register:u,logout:()=>{a.logout(),c(null)},isAuthenticated:T},children:s})}function i(){let e=(0,r.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}]);